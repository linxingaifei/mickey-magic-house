<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mickey V2Ray ä¸€å¯¹ä¸€è½¬å‘</title>
  <style>
    :root {
      --bg: #14051f;
      --card: #231235;
      --soft: #3f2758;
      --text: #f9eefe;
      --pink: #ff6bd6;
      --purple: #9f6dff;
    }
    body { margin:0; font-family: "Segoe UI",sans-serif; background:radial-gradient(circle at top right,#4b2469,var(--bg)); color:var(--text); }
    .wrap { max-width:1080px; margin:24px auto; padding:0 16px 32px; }
    .hero { background:linear-gradient(135deg,rgba(255,107,214,.15),rgba(159,109,255,.16)); border:1px solid #6a3d93; border-radius:16px; padding:16px 20px; }
    h1 { margin:0 0 8px; font-size:24px; }
    .grid { display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); margin-top:16px; }
    .card { background:var(--card); border:1px solid #5f3d86; border-radius:14px; padding:14px; }
    input, select { width:100%; box-sizing:border-box; margin:4px 0 10px; background:#1a1029; border:1px solid var(--soft); color:var(--text); border-radius:10px; padding:8px; }
    button { border:0; border-radius:10px; padding:8px 12px; color:white; cursor:pointer; background:linear-gradient(90deg,var(--pink),var(--purple)); }
    button.sub { background:#3b2951; }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    th,td { border-bottom:1px solid #4a2f67; padding:8px 4px; text-align:left; }
    .row { display:flex; gap:8px; flex-wrap:wrap; }
    .tip { font-size:12px; opacity:.8; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <h1>ğŸ’œ Mickey V2Ray ä¸€é”®é¢æ¿</h1>
    <div>OpenWrt / SOCKS5 / å†…ç½‘åœ°å€ä¸€å¯¹ä¸€è½¬å‘</div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>èŠ‚ç‚¹ç®¡ç†ï¼ˆå¯¼å…¥ / åˆ é™¤ / æ›´æ–° / é€‰æ‹©ï¼‰</h3>
      <input id="node_id" placeholder="èŠ‚ç‚¹IDï¼Œå¦‚ hk-01">
      <input id="node_host" placeholder="SOCKS5 åœ°å€">
      <input id="node_port" placeholder="ç«¯å£ï¼Œä¾‹å¦‚ 1080">
      <input id="node_user" placeholder="ç”¨æˆ·åï¼ˆå¯ç©ºï¼‰">
      <input id="node_pass" placeholder="å¯†ç ï¼ˆå¯ç©ºï¼‰">
      <div class="row">
        <button onclick="importNode()">ä¸€é”®å¯¼å…¥/æ›´æ–°</button>
        <button class="sub" onclick="deleteNode()">åˆ é™¤èŠ‚ç‚¹</button>
      </div>
      <select id="node_select"></select>
      <button onclick="selectNode()">é€‰æ‹©èŠ‚ç‚¹</button>
    </div>

    <div class="card">
      <h3>ä¸€å¯¹ä¸€å†…ç½‘è½¬å‘</h3>
      <input id="rule_id" placeholder="è§„åˆ™IDï¼Œå¦‚ cam-01">
      <input id="rule_lan" placeholder="ç›‘å¬å†…ç½‘IPï¼Œä¾‹å¦‚ 192.168.1.1">
      <input id="rule_listen_port" placeholder="ç›‘å¬ç«¯å£">
      <input id="rule_target_host" placeholder="ç›®æ ‡ä¸»æœº">
      <input id="rule_target_port" placeholder="ç›®æ ‡ç«¯å£">
      <div class="row">
        <button onclick="saveRule()">ä¿å­˜/æ›´æ–°æ˜ å°„</button>
        <button class="sub" onclick="deleteRule()">åˆ é™¤æ˜ å°„</button>
      </div>
      <p class="tip">æ¯æ¡è§„åˆ™éƒ½å¯å›ºå®šå‡ºå£èŠ‚ç‚¹ï¼Œå®ç°å†…ç½‘åœ°å€ä¸€å¯¹ä¸€ä»£ç†è½¬å‘ã€‚</p>
    </div>

    <div class="card">
      <h3>è™é¢èŠ‚ç”µï¼ˆæ¨¡å¼ï¼‰</h3>
      <select id="mode_select">
        <option value="balanced">å¹³è¡¡</option>
        <option value="performance">æ€§èƒ½ä¼˜å…ˆ</option>
        <option value="eco">èŠ‚ç”µä¼˜å…ˆ</option>
      </select>
      <button onclick="setMode()">ä¸€é”®åˆ‡æ¢æ¨¡å¼</button>
      <p class="tip">æ¨¡å¼ä¿¡æ¯ä¼šè®°å½•åœ¨æ§åˆ¶é¢æ¿ï¼Œå¯è¢«è®¡åˆ’ä»»åŠ¡è¯»å–åšåŠŸè€—ç­–ç•¥ã€‚</p>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <h3>å½“å‰é…ç½®é¢„è§ˆ</h3>
    <pre id="preview" style="white-space:pre-wrap; background:#170d25; border-radius:10px; padding:10px;"></pre>
  </div>
</div>

<script>
const API='/cgi-bin/mickey-v2ray-api';
const j=(u,m='GET',b)=>fetch(API+u,{method:m,headers:{'Content-Type':'application/json'},body:b?JSON.stringify(b):undefined}).then(r=>r.json());

async function refresh(){
  const data=await j('/state');
  const sel=document.getElementById('node_select');
  sel.innerHTML='';
  data.nodes.forEach(n=>{const o=document.createElement('option');o.value=n.id;o.textContent=`${n.id} (${n.host}:${n.port})`; if(data.state.selectedNode===n.id)o.selected=true; sel.appendChild(o);});
  document.getElementById('mode_select').value=data.state.mode||'balanced';
  document.getElementById('preview').textContent=JSON.stringify(data,null,2);
}
async function importNode(){await j('/node/import','POST',{id:v('node_id'),host:v('node_host'),port:Number(v('node_port')),username:v('node_user'),password:v('node_pass')});refresh();}
async function deleteNode(){await j('/node/delete','POST',{id:v('node_id')});refresh();}
async function selectNode(){await j('/node/select','POST',{id:document.getElementById('node_select').value});refresh();}
async function saveRule(){await j('/rule/upsert','POST',{id:v('rule_id'),lan_ip:v('rule_lan'),listen_port:Number(v('rule_listen_port')),target_host:v('rule_target_host'),target_port:Number(v('rule_target_port'))});refresh();}
async function deleteRule(){await j('/rule/delete','POST',{id:v('rule_id')});refresh();}
async function setMode(){await j('/mode/set','POST',{mode:document.getElementById('mode_select').value});refresh();}
function v(id){return document.getElementById(id).value.trim();}
refresh();
</script>
</body>
</html>